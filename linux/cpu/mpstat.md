# mpstat

显示各个处理器相关的统计信息

主要用于多CPU环境下，它显示各个可用CPU的状态信息。这些信息存放在`/proc/stat`文件中。在多CPU系统里，其不但能查看所有CPU的平均状况信息，而且能够查看特定CPU的信息

## 格式

```shell
mpstat [ -A ] [ -u ] [ -V ] [ -I { SUM | CPU | SCPU | ALL } ] [ -P { cpu [,...] | ON | ALL } ] [ interval [ count ] ]
```

## 参数

```shell
internal	相邻的两次采样的间隔时间
count		采样的次数
-A		此选项等效于指定-u -I ALL -P ALL
-I		{SUM | CPU | SCPU | ALL}
        报告中断统计信息
        SUM关键字，mpstat命令报告每个处理器的中断总数
        CPU关键字，显示一个或多个CPU每秒接收的每个单独中断的数量
        SCPU关键字，显示一个或多个CPU每秒接收的每个软件中断的数量
        ALL关键字等效于指定上面的所有关键字，因此将显示所有中断统计信息
-P		{ cpu [,...] | ON | ALL }指示要报告其统计信息的处理器编号
		cpu是处理器编号，处理器0是第一个处理器
		ON关键字表示将为每个联机处理器报告统计信息
		ALL关键字指示将为所有处理器报告统计信息
-u		报告CPU利用率
```

## 实例

### 查看总的cpu使用率

```elm
[sgeapp@localhost ~]$ mpstat -u 1
Linux 3.10.0-514.el7.x86_64 (localhost.localdomain) 	2020年04月16日 	_x86_64_	(1 CPU)

23时57分42秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
23时57分43秒  all    0.00    0.00    1.01    0.00    0.00    0.00    0.00    0.00    0.00   98.99
23时57分44秒  all    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
23时57分45秒  all    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
23时57分46秒  all    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
23时57分47秒  all    1.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00   98.00
^C
平均时间:    all    0.20    0.00    0.41    0.00    0.00    0.00    0.00    0.00    0.00   99.39
```

- **CPU**  处理器号码。关键字ALL表示统计数据是以所有处理器之间的平均值计算的。  
- **%usr**  显示在用户级别(应用程序)执行时出现的CPU利用率百分比。
- **%nice**  以良好的优先级在用户级别执行时显示CPU利用率的百分比。 
- **%sys**  显示在系统级(内核)执行时CPU利用率的百分比。请注意，这不包括用于服务硬件和软件中断的时间。
- **%iowait**  显示CPU或CPU空闲的时间百分比，在此期间，系统有未执行的磁盘I/O请求。
- **%irq**  显示cpu或cpu用于服务硬件中断的时间百分比。 
- **%soft**  显示CPU或CPU用于服务软件中断的时间百分比。 
-  **%steal**  显示虚拟机管理程序为另一个虚拟处理器服务时，虚拟CPU或CPU在非自愿等待中花费的时间百分比。
- **%guest**  显示CPU或cpu运行虚拟处理器所花费的时间百分比。  
- **%gince**  显示一个或多个CPU运行一个好的guest虚拟机所花费的时间百分比  
- **%idle**  显示CPU或CPU空闲的时间百分比，并且系统没有未执行的磁盘I/O请求。

### 查看单个cpu使用率

```elm
[root@fanqq fanqq]# mpstat -P ALL 1
Linux 3.10.0-957.21.3.el7.x86_64 (fanqq) 	05/03/2020 	_x86_64_	(2 CPU)

03:31:37 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
03:31:38 PM  all    0.50    0.00    0.50    0.00    0.00    0.00    0.00    0.00    0.00   98.99
03:31:38 PM    0    1.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   99.00
03:31:38 PM    1    0.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00   99.00
```

### 查看cpu总中断数

```elm
[root@fanqq fanqq]# mpstat -I SUM 1
Linux 3.10.0-957.21.3.el7.x86_64 (fanqq) 	05/03/2020 	_x86_64_	(2 CPU)

03:35:27 PM  CPU    intr/s
03:35:28 PM  all    770.30
03:35:29 PM  all    665.00
03:35:30 PM  all    714.00
```

### 查看每个cpu硬中断数

```elm
[root@fanqq fanqq]# mpstat -I CPU 
Linux 3.10.0-957.21.3.el7.x86_64 (fanqq) 	05/03/2020 	_x86_64_	(2 CPU)

03:36:51 PM  CPU        0/s        1/s        4/s        6/s        8/s        9/s       11/s       12/s       14/s       15/s       24/s       25/s       26/s       27/s       28/s       29/s       30/s      NMI/s      LOC/s      SPU/s      PMI/s      IWI/s      RTR/s      RES/s      CAL/s      TLB/s      TRM/s      THR/s      DFR/s      MCE/s      MCP/s      ERR/s      MIS/s      PIN/s      NPI/s      PIW/s
03:36:51 PM    0       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.25       0.00       0.00       0.00       0.63       0.00       0.00     160.89       0.00       0.00       2.98       0.00      43.20       0.00       0.05       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00
03:36:51 PM    1       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00     161.31       0.00       0.00       2.86       0.00      41.99       0.00       0.05       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00       0.00
```

### 查看每个cpu软中断数

```elm
[root@fanqq fanqq]# mpstat -I SCPU 
Linux 3.10.0-957.21.3.el7.x86_64 (fanqq) 	05/03/2020 	_x86_64_	(2 CPU)

03:38:40 PM  CPU       HI/s    TIMER/s   NET_TX/s   NET_RX/s    BLOCK/s BLOCK_IOPOLL/s  TASKLET/s    SCHED/s  HRTIMER/s      RCU/s
03:38:40 PM    0       0.00      29.21       0.00       0.73       0.00       0.00       0.00      17.12       0.00      13.76
03:38:40 PM    1       0.00      29.14       0.00       0.06       0.00       0.00       0.00      16.94       0.00      13.47
```

