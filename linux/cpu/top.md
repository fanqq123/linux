# top

顶层程序提供正在运行的系统的动态实时视图。

它可以显示系统摘要信息以及进程列表，或当前由Linux内核管理的线程的类型显示的系统摘要信息以及信息的类型，顺序和大小进程显示的信息都是用户可配置的，并且可以使配置在重新启动后持续存在

## 格式

```shell
top -hv|-bcHiOSs -d secs -n max -u|U user -p pid -o fld -w [cols]
```

## 选项

```shell
-h|-v        帮助/版本
-b			 批处理模式，用于记录输出信息，配合-d和-n使用
-c			 显示整个命令行，不只是显示命令名
-d			 延迟时间间隔
-n			 迭代次数限制
-O			 输出每个可用字段名称
-p	         监视指定PID进程，多个用逗号分割 -p 211,222,233
-u	         仅显示指定用户的进程
-s			 在安全模式中运行，去除交互命令所带来的风险
-i			 不现实任何闲置进程或者僵尸进程
```

## 实例

![image-20200410171609305](..\..\images\image-20200410171609305.png)

**第一行:系统正常运行时间和平均负载**

- 当前系统时间
- 上次启动以来系统运行时间
- 当前登录用户
- 1分钟、5分钟、15分钟的系统平均负载

**第二行：任务**

总进程数、正在运行、睡眠、暂停、僵尸

**第三行：cpu状态**

- us — 用户空间占用CPU的百分比。
- sy — 内核空间占用CPU的百分比。
- ni — 改变过优先级的进程占用CPU的百分比
- id — 空闲CPU百分比
- wa — IO等待占用CPU的百分比
- hi — 硬中断占用CPU的百分比
- si — 软中断占用CPU的百分比
- st — 虚拟机管理程序从此虚拟机窃取的时间

**第四行：内存状态**

总量、空闲、已使用、缓存

**第五行：swap状态**

总量、空闲、已使用、可用

**默认字段说明**

```shell
PID		   进程pid
USER       进程所有者
PR         进程优先级
NI         nice值，负值表示高优先级，正值表示低优先级
VIRT       是进程虚拟内存的大小，只要是进程申请过的内存，即便还没有真正分配物理内存，也会计算在内单位kb
RES        是常驻内存的大小，也就是进程实际使用的物理内存大小，但不包括 Swap 和共享内存
SHR        是共享内存的大小，比如与其他进程共同使用的共享内存、加载的动态链接库以及程序的代码段等
S		   进程状态
%CPU       上次更新到现在的CPU时间占用百分比
%MEM       进程使用的物理内存百分比
TIME+      进程启动以来已使用的总CPU时间，单位1/100秒       
COMMAND    进程名称
```

**全局命令**

```erlang
f|F 选择要显示的内容
	上下键选择字段，PgUp、PgDn快速切到第一个最后一个字段
	右箭头键选择要重新定位的字段，然后选择左箭头键或<Enter>键将提交     该字段的位置
	d键切换字段显示状态
	s键指定排序字段，默认排序字段%CPU
	a、w键可用于循环显示所有可用的字段
	q、Esc退出
A   显示模式切换，在全屏模式和普通模式之间进行切换
B   关键字段粗体显示，x粗体竖向显示排序字段
d|s 更改延迟时间间隔
E   以KB MB GB等显示摘要MEM
e   以KB MB GB等显示任务区
g   选择另一个窗口/字段组1-4之间选择
H   线程模式切换，将显示单个线程
k   杀死进程，提示输入PID
r   修改进程优先级，提示输入PID，然后在输入nice值
Z   更改颜色
z   带颜色显示
```

**摘要区命令**

```erlang
C   显示滚动坐标切换
l   平均负载/正常运行时间切换
t   cpu状态显示方式切换
m   内存swap显示方式切换
1   监控每个逻辑CPU的状况
```

**任务区命令**

```erlang
J   右对齐
j   左对齐
b   关键字段粗体显示
x   高亮竖向显示排序字段
y   行高亮显示
z   彩色切换
c   命令行/程序名切换
f|F 字段显示管理
U   仅显示特定用户
V   类似树状显示布局
i   空闲进程切换
n   设置显示最大进程数
```

**任务窗口排序**

```erlang
M   按照MEM排序
N   按照PID排序
P   按照CPU排序
T   按照TIME+排序
R   反向排序显示
```

**Linux查看物理CPU个数、核数、逻辑CPU个数**

```shell
# 总核数 = 物理CPU个数 X 每颗物理CPU的核数 
# 总逻辑CPU数 = 物理CPU个数 X 每颗物理CPU的核数 X 超线程数

# 查看物理CPU个数
cat /proc/cpuinfo| grep "physical id"| sort| uniq| wc -l

# 查看每个物理CPU中core的个数(即核数)
cat /proc/cpuinfo| grep "cpu cores"| uniq

# 查看逻辑CPU的个数
cat /proc/cpuinfo| grep "processor"| wc -l
```